<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
		<meta name="format-detection" content="telephone=no"/>
		<title>代维调度待办操作列表</title>
		<link rel="stylesheet" type="text/css" href="../../css/api.css" />
		<link rel="stylesheet" type="text/css" href="../../css/common.css" />
		<link rel="stylesheet" type="text/css" href="../../css/aui.css" />
		<link rel="stylesheet" type="text/css" href="../../css/aui-flex.css" />
		<link rel="stylesheet" href="../../script/ccssoft/css/ccssoft-lite.css" />
		<link rel="stylesheet" type="text/css" href="../../script/easydialog/easydialog.css" />
		<link rel="stylesheet" href="../../css/lightForBillMenu.css">
		<link rel="stylesheet" href="../../css/darkForBillMenu.css"  disabled>
		<link rel="stylesheet" type="text/css" href="../../css/billMenu.css" />
		<style>
			input[type="text"], input[type="password"], input[type="email"], input[type="url"], input[type="number"], input[type="week"], input[type="month"], input[type="time"], input[type="date"], input[type="datetime"], input[type="datetime-local"], input[type="search"], input[type="file"], input[type="color"], select, textarea {
				outline: none;
			}
			html, body, #wrap, #header {
				background: transparent;
			}
			#header {
				height: 58px;
			}
			.shadow {
				position: absolute;
				width: 100%;
				height: 100%;
				left: 0;
				top: 0;
				z-index: 1;
				background: #333;
				opacity: 0.6;
				filter: alpha(opacity=60);
			}
			.menu-list li span {
				text-indent: 1em;
			}
			#revertDiv {
				-webkit-box-flex: 1;
				-webkit-flex: 1;
				flex: 1;
			}
			.winDiv {
				display: none;
				background-color: #f2f2f2;
				-webkit-border-radius: 10px;
				-moz-border-radius: 10px;
				border-radius: 10px;
			}
			.winTitleDiv {
				text-align: center;
				font-size: 20px;
				color: #FFFFFF;
				background-color: #DB4537;
				height: 35px;
				line-height: 35px;
				-webkit-border-radius: 10px 10px 0 0;
				-moz-border-radius: 10px 10px 0 0;
				border-radius: 10px 10px 0 0;
			}
			.winContentSnDiv {
				font-size: 16px;
				height: 30px;
				line-height: 30px;
				margin-top: 20px;
				text-align: center;
				background-color: #F2F2F2;
			}
			.winContentTitleDiv {
				font-size: 16px;
				height: 30px;
				line-height: 30px;
				margin-bottom: 20px;
				text-align: center;
				background-color: #F2F2F2;
			}
			.winButtonDiv {
				background-color: #e0e0e0;
				height: 50px;
				width: 300px;
				-webkit-border-radius: 0 0 10px 10px;
				-moz-border-radius: 0 0 10px 10px;
				border-radius: 0 0 10px 10px;
			}
			.winOkBtn {
				width: 130px;
				height: 40px;
				color: #FFFFFF;
				text-align: center;
				font-size: 20px;
				-webkit-border-radius: 5px;
				-moz-border-radius: 5px;
				border-radius: 5px;
				background-color: #DB4537;
				float: right;
				margin-top: 5px;
				margin-right: 5px;
			}
			.winCancelBtn {
				width: 130px;
				height: 40px;
				color: #FFFFFF;
				text-align: center;
				font-size: 20px;
				-webkit-border-radius: 5px;
				-moz-border-radius: 5px;
				border-radius: 5px;
				background-color: #3779d0;
				float: left;
				margin-left: 5px;
				margin-top: 5px;
			}
			.otherDivHeader {
				text-align: center;
				font-size: 20px;
				color: #FFFFFF;
				background-color: #DB4537;
				height: 40px;
				line-height: 40px;
				-webkit-border-radius: 10px 10px 0 0;
				-moz-border-radius: 10px 10px 0 0;
				border-radius: 10px 10px 0 0;
			}
		.isArgeeInfo {
			 background-color: #FFFFFF;
			 border: 1px solid #adadad;
			 margin-top: 5px;
			 -webkit-border-radius: 5px;
			 -moz-border-radius: 5px;
			 float:left;
			 width:90%;
			 border-radius: 5px;
			 }
			.labelDiv {
				text-align: center;
				font-size: 16px;
				color: #3498DB;
				height: 30px;
				line-height: 30px;
			}
			.allDiv {
				width: 100%;
			}
			.left {
				text-align: right;
				font-size: 16px;
				float: left;
				color: #000000;
				width: 30%;
			}
			.right {
				text-align: left;
				float: right;
				font-size: 16px;
				color: #787878;
				width: 67%;
			}
			.transferDiv {
				width: 300px;
				height: 40px;
			}
			.isAgreeSel {
			 -webkit-border-radius: 5px;
			 -moz-border-radius: 5px;
			 border-radius: 5px;
			 width:90%;
			 margin-top:10px;
			 float:left;
			 border: 1px solid #adadad;
			 background-color: #FFFFFF;
			 /*border: none !important;*/
			 }
			.isArgee {
				width: 100%;
				height: 40px;
				margin-right: 10px;
				-webkit-border-radius: 5px;
				-moz-border-radius: 5px;
				border-radius: 5px;
				background-color: #FFFFFF;
				border: none !important;
			}
			.transferTime {
				width: 265px;
				height: 40px;
				margin-left: 10px;
				-webkit-border-radius: 5px;
				-moz-border-radius: 5px;
				border-radius: 5px;
				background-color: #FFFFFF;
			}
			.menuListLi {
				height: 40px;
				line-height: 40px;
				color: #46a3FF;
				text-align: center;
				font-size: 16px;
			}
			.noborder {
				border: none !important;
			}
			.textStyle {
				padding-left: 3px;
				height: 40px;
				line-height: 40px;
				text-align: left;
				color: #adadad;
			}
		</style>
	</head>
	<body>
		<!--下拉列表-->
		<script id="dict-template" type="text/x-dot-template">
			{{ for(var i=0, len=it.length; i < len; i++) {}}
			<option value="{{=it[i].itemvalue}}">{{=it[i].itemname}}</option>
			{{ } }}
		</script>

		<script id="option-template" type="text/x-dot-template">
			{{ for(var i=0, len=it.length; i < len; i++) {}}
			<option value="{{=it[i].userid}}">{{=it[i].username}}</option>
			{{ } }}
		</script>
		<script id="standBillMenu-template" type="text/x-dot-template">
			<ul class="menu-list">
			{{? it.level == '0'}}
			<li class="menuListLi" tapmode="tap-active" onclick="optBill('add')">新增</li>
			<li class="menuListLi" tapmode="tap-active" onclick="showPopup()">查询</li>
			{{?}}
			{{? it.level == '1' }}
				{{? (it.roleName.indexOf("应急办主任") != -1 &&  it.provinceName == it.province && it.statusText == '待省主任审核')||
				(it.roleName.indexOf("应急办主任") != -1  && it.cityName == it.city && it.statusText == '待地市主任审核' && it.cityName!= '中国铁塔')||
			(it.roleName.indexOf("应急主管") != -1 &&  it.provinceName == it.province && it.statusText == '待省主管审核')||
			(it.roleName.indexOf("应急主管") != -1  && it.cityName == it.city && it.statusText == '待地市主管审核' && it.cityName!= '中国铁塔')}}
				<li class="menuListLi" tapmode="tap-active" onclick="submissionAudit();">审核通过</li>
				<li class="menuListLi" tapmode="tap-active" onclick="submissionRemove();">退回</li>
				{{?}}
				{{? it.uuid == it.createPerson}}
				<li class="menuListLi" tapmode="tap-active" onclick="submissionUpgrade();">升级</li>
					{{? it.statusText == '已审核'||it.statusText == '待报送'}}
						<li class="menuListLi" tapmode="tap-active" onclick="openAgain()">报送</li>
					{{?}}
					{{? it.statusText == '已审核'}}
						<li class="menuListLi" tapmode="tap-active" onclick="submissionClose();">关闭</li>
					{{?}}
				{{?}}
			{{?}}
			</ul>
		</script>
		<div id="wrap" >
			<div id="shadowId" class="shadow" tapmode="" onclick="closeFrame('submissionBillMenu')"></div>
			<div id="header"></div>
			<div id="standBillMenuMain"></div>
		</div>
		<!--是否及时上站-->
		<div id="ispromptModelPanel" class="winDiv">
			<div class="winTitleDiv">
				是否及时上站？
			</div>
			<div class="labelDiv">
				<div style="font-size:16px;color:#adadad;">
					是否及时上站
				</div>
			</div>
			<div class="transferDiv">
				<select id="isStandSelId" class="transferSel noborder" value="">
					<option value="Y">是</option>
					<option value="N">否</option>
				</select>
			</div>
			<div class="labelDiv">
				<div style="font-size:16px;color:#adadad;">
					实际上站时间
				</div>
			</div>
			<div class="transferDiv">
				<input type="datetime-local" id="standTimeId" class="" value="" style="width: 94%;"/>
			</div>
			<div class="labelDiv">
				<div style="font-size:16px;color:#adadad;">
					未及时上站原因
				</div>
			</div>
			<div>
				<textarea id="dealCommentId" class="otherDealInfo" rows="5" cols="5"></textarea>
			</div>
			<div class="winButtonDiv">
				<button class="winCancelBtn"  onclick="closeFrame('submissionBillMenu')">
					取消
				</button>
				<button class="winOkBtn"  onclick="isStandFunc()">
					确定
				</button>
			</div>
		</div>
		<!--是否及时上站-->
		<!--同意-->
		<div id="isAgreeModelPanel" class="aui-content winDiv" style="width: 300px; background-color: #f2f2f2; display: none;">
			<div class="winTitleDiv">
				是否同意？
			</div>
			<div  class="aui-flex-col aui-flex-middle">
				<div class="aui-flex-item-4 aui-flex-middle" style="text-align: center">
					是否同意:
				</div>
				<div class="aui-flex-item-8">
					<select id="isAgreeSelId" class="isAgreeSel" data-valid="required" onchange="isAgree()" data-error="请选择是否同意"  value="">
						<option value="">请选择</option>
						<option value="Y">是</option>
						<option value="N">否</option>
					</select>
				</div>
			</div>
			<div  class="aui-flex-col aui-flex-middle" id="test1">
				<div class="aui-flex-item-4 aui-flex-middle" style="text-align: center">
					是否免责:
				</div>
				<div class="aui-flex-item-8">
					<select id="isreiefId" name="isreief" class=" isAgreeSel" onchange="isrelief()"  data-valid="required" data-error="请选择是否免责"  value="">
						<option value="">请选择</option>
						<option value="Y">是</option>
						<option value="N">否</option>
					</select>
				</div>
			</div>
			<div  class="aui-flex-col aui-flex-middle"  id="test2">
				<div class="aui-flex-item-4 aui-flex-middle" style="text-align: center">
					免责条款:
				</div>
				<div class="aui-flex-item-8">
					<select id="isreieftypeId" name="isreieftype" class="isAgreeSel" data-valid="isRelief" data-error="请选择免责条款"  value="">
						<option value="">请选择</option>
						<option value="1">免责条款1-不可抗力</option>
						<option value="2">免责条款2-夜间免责</option>
						<option value="3">免责条款3-客户原因</option>
						<option value="4">免责条款4-免责站址</option>
						<option value="5">免责条款5-其他免责</option>
					</select>
				</div>
			</div>
			<div  class="aui-flex-col aui-flex-middle" id="test3">
				<div class="aui-flex-item-4 aui-flex-middle" style="text-align: center">
					免责具体原因:
				</div>
				<div class="aui-flex-item-8">
					<textarea id="reliefDealcommentId" rows="2"  class="isArgeeInfo"></textarea>
				</div>
			</div>
			<div class="aui-flex-col aui-flex-middle">
				<div class="aui-flex-item-4 " style="margin-bottom: 10px;text-align: center;">
					处理措施:
				</div>
				<div class="aui-flex-item-8">
					<textarea id="agreeDealCommentId" class="isArgeeInfo" rows="5" cols="5"></textarea>
				</div>
			</div>
			<div class="winButtonDiv">
				<button class="winCancelBtn"  onclick="closeFrame('submissionBillMenu')">
					取消
				</button>
				<button class="winOkBtn"  onclick="isAgreeFunc()">
					确定
				</button>
			</div>
		</div>

		<!--协调上站begin-->
		<div id="coordinateModelPanel" class="winDiv">
			<div class="winTitleDiv">
				协调上站？
			</div>
			<div id="contactTelSpanId1"class="aui-flex-col" data-type="text" style="margin-top: 10px;">
				<div class="aui-flex-item-4 aui-flex-middle textStyle" >
					是否需要随工
				</div>
				<div class="aui-flex-item-8 " >
					<select id="isNeedSelId" class="textareaborder" style="padding: 5px 0px;padding-left: 5px;width: 92%;" value=""  onchange="toggleFsuStatus(this)">
						<option value="">请选择</option>
						<option value="Y">是</option>
						<option value="N">否</option>
					</select>
				</div>
			</div>
			<div id="fsuStatusLabel"class="aui-flex-col " data-type="text"  style="display: none">
				<div class="aui-flex-item-4 textStyle" style="text-align: right">
					FSU状态
				</div>
				<div class="aui-flex-item-8 " >
					<select id="fsuStatus" class="textareaborder" style="padding: 5px 0px;padding-left: 5px;width: 92%" value=""  >
						<option value="">请选择</option>
						<option value="Y">是</option>
						<option value="N">否</option>
					</select>
				</div>
			</div>
			<div id="contactTelSpanId1"class="aui-flex-col" data-type="text" >
				<div class="aui-flex-item-4 textStyle" >
					是否如约上站
				</div>
				<div class="aui-flex-item-8 " >
					<select id="isBookSelId" class="textareaborder" style="padding: 5px 0px;padding-left: 5px;width: 92%" value=""  onchange="isOnTime()">
						<option value="">请选择</option>
						<option value="Y">是</option>
						<option value="N">否</option>
					</select>
				</div>
			</div>
			<div class="aui-flex-col" data-type="text" >
				<div class="aui-flex-item-4 textStyle" >
					协调上站时间
				</div>
				<div  id="applyStandDateDivId" class="aui-flex-item-8 " style="display:none" >
					<input type="text" id="applyStandDateId" readonly="readonly" class="" value="" style="width: 92%;" />
				</div>
				<div  id="coorStandDateDivId" class="aui-flex-item-8 "  >
					<input type="datetime-local" id="coorStandDateId"  class="" value="" style="width: 92%;padding-left: 2px;" />
				</div>
			</div>
			<div class="aui-flex-col" data-type="text" >
				<div class="aui-flex-item-4 textStyle" >
					协调离站时间
				</div>
				<div  id="applyStandDateDivId" class="aui-flex-item-8 "  >
					<input type="datetime-local" id="outStandDateId"  class="textareaborder" value="" style="float:left; margin-left: 10px; padding: 5px 2px;width: 92%;" />
				</div>
			</div>
			<div class="aui-flex-col" data-type="text" >
				<div class="aui-flex-item-4 textStyle"  style="text-align: right">
					处理意见
				</div>
				<div  class="aui-flex-item-8 "  >
					<textarea id="coorDealCommentId" class="otherDealInfo" rows="5" cols="5" style="width: 92%"></textarea>
				</div>
			</div>
			<div class="winButtonDiv">
				<button class="winCancelBtn"  onclick="closeFrame('submissionBillMenu')">
					取消
				</button>
				<button class="winOkBtn"  onclick="coordinateFunc()">
					确定
				</button>
			</div>
		</div>
		<!--协调上站end-->
		<!--领取任务begin-->
		<div id="receiveDiv" class="winDiv">
			<div class="winTitleDiv">
				确定领取任务？
			</div>
			<div  id="transferLabelDivId1" class="selectLabelDiv" style="margin-top: 10px;" >
				<div id="user_name1" style="font-size:16px;color:#adadad;text-align:left; margin-left:23px;">
					操作人
				</div>
			</div>

			<div class="winButtonDiv">
				<button class="winCancelBtn"  onclick="closeFrame('submissionBillMenu')">
					取消
				</button>
				<button class="winOkBtn"  onclick="acceptFunc()">
					确定
				</button>
			</div>
		</div>
		<!--领取任务end-->
		<!--离站begin-->
		<div id="leaveStation" class="winDiv">
			<div class="winTitleDiv">
				确定离站？
			</div>
			<div id="opinionLabelDiv1"class="aui-flex-col" data-type="text"style="margin-top: 5px;">
				<div class="aui-flex-item-3 " style="margin-left:2px; height: 40px;line-height: 40px; text-align: right;color:#adadad;">
					离站说明:
				</div>
				<div class="aui-flex-item-8 " >
					<textarea id="dealComment" class="dealInfo" rows="5" cols="10" ></textarea>
				</div>
			</div>
			<div class="winButtonDiv">
				<button class="winCancelBtn"  onclick="closeFrame('submissionBillMenu')">
					取消
				</button>
				<button class="winOkBtn"  onclick="leaveStation()">
					确定
				</button>
			</div>
		</div>
		<!--离站end-->
		<!--审批begin-->
		<div id="auditModelPanel" class="winDiv">
			<div class="winTitleDiv">
				确认是否完成？
			</div>

			<div class="transferDiv" style="padding:10px 0;">
				<select id="auditFlagId" class="transferSel" value="">
					<option value="">请选择</option>
					<option value="Y">完成</option>
					<option value="N">未完成</option>
				</select>
			</div>

			<div class="winButtonDiv" style="margin-top:20px;">
				<button class="winCancelBtn"  onclick="closeFrame('submissionBillMenu')">
					取消
				</button>
				<button class="winOkBtn"  onclick="zndwFunc()">
					确定
				</button>
			</div>
		</div>
		<!--审批end-->
		<!--上站确认begin-->
		<div id="confireDiv" class="winDiv">
			<div class="winTitleDiv">
				确认上站？
			</div>
			<div class="labelDiv">
				<div style="font-size:16px;color:#adadad;">
					FSU是否正常
				</div>
			</div>
			<div class="transferDiv">
				<select name="fsuStatus" class="transferSel" value="" disabled style="text-align: center"></select>
			</div>
			<div class="labelDiv" >
				<div style="font-size:16px;color:#adadad;">
					上站方式
				</div>
			</div>
			<div class="transferDiv" style="margin-bottom: 10px;">
				<select id="standType" class="transferSel" value="">
					<option value="">请选择</option>
					<option value="1">借钥匙</option>
					<option value="2">自行上站</option>
				</select>
			</div>
			<div class="winButtonDiv">
				<button class="winCancelBtn"  onclick="closeFrame('submissionBillMenu')">
					取消
				</button>
				<button class="winOkBtn"  onclick="confireFunc()">
					确定
				</button>
			</div>
		</div>
		<!--上站确认end-->
		<!--最终审核begin-->
		<div id="lastConfireData" class="winDiv">
			<div class="winTitleDiv">
				最终审核
			</div>
			<div id="info" style="text-align: center;font-size:18px;margin-top: 15px;"></div>
			<div  id="isreliefType" class="aui-list-view-cell">
				<div id="reliefLeft" class="left" ></div>
				<div id="reliefRight" class="right"  ></div>
			</div>
			<div id="isreliefCause" class="aui-list-view-cell">
				<div class="left" >
					免责原因：
				</div>
				<div id="reliefCause" class="right" ></div>
			</div>
			<div class="aui-list-view-cell">
				<div class="left" >
					是否同意：
				</div>
				<div class="right" >
					<select  id="isArgeeConfire"  value="">
						<option value="">请选择</option>
						<option value="Y">是</option>
						<option value="N">否</option>
					</select>
				</div>
			</div>
			<div class="winButtonDiv">
				<button class="winCancelBtn"  onclick="closeFrame('submissionBillMenu')">
					取消
				</button>
				<button class="winOkBtn"  onclick="lastConfireFunc()">
					确定
				</button>
			</div>
		</div>
		<!--最终审核end-->
	</body>
	<script src="../../script/jquery-1.11.3.min.js"></script>
	<script type="text/javascript" src="../../script/api.js"></script>
	<script type="text/javascript" src="../../script/doT.min.js"></script>
	<script type="text/javascript" src="../../script/theme.js"></script>
	<script type="text/javascript" src="../../script/easydialog/easydialog.js"></script>
	<script type="text/javascript" src="../../script/common.js"></script>
	<script type="text/javascript" src="../../script/debug.js"></script>
	<script type="text/javascript" src="../../script/config.js"></script>
	<script type="text/javascript" src="../../script/client.api.js"></script>
	<script type="text/javascript" src="../../script/GPS.js"></script>
	<script type="text/javascript" src="script/standBillMenu.js"></script>
	<script type="text/javascript">
	// 离站操作
			function leaveStation(){
					var userId = $api.getStorage('user').userid;
					var remark = $('#dealComment').val();
					var opts={
						applyId:menuApplyId,
						standCause:standCause,
						userId:userId,
						remark:remark
					}
					$client.leaveStation(opts,function(ret,err){
						if(ret.success){
							finishOptBill("离站确认成功",'leaveStation');
						}else {
							api.toast({
									msg: ret.errorMsg,
									duration: 2000,
									location: 'bottom'
							});
						}
					})
			}

			// 问题确认
			function zndwFunc(){
				var status = $('#auditFlagId').val();
				var generationBillMenu = $api.getStorage('generationBillMenu');
				var opts={
					id:generationBillMenu.id,
					status:status
				};
				$client.getGenerationConfirm(opts,function(ret,err){
					if(ret.success){
						finishOptBill("问题确认成功",'leaveStation');
					}else {
						api.toast({
								msg: ret.errorMsg,
								duration: 2000,
								location: 'bottom'
						});
					}
				})
			}

			// 打开查询工单页面
			function showPopup() {
					var query_setting = {
							submissionQuery1 : true,
							submissionQuery2 : true,
							submissionQuery3 : true,
							submissionQuery4 : true,
							submissionQuery5 : true,
							submissionQuery6 : true,
							winName : api.winName,
							frameName : 'submission-list_frm',
							callback : 'cb_queryBillList'
					};
					api.openFrame({
							name : 'popup_query_frm',
							url : '../dialog/popup_query.html',
							rect : {
									x : 0,
									y : 0,
									w : 'auto',
									h : 'auto'
							},
							bounces : false,
							pageParam : query_setting
					});
			}

			// 审核通过

					function submissionAudit(){
						console.log(getObj(api.pageParam.message));
						var user=$api.getStorage('user');
						var opts={

						}
						var emEventReport=$api.getStorage('emEventReport');


						emEventReport['userName']=user.loginname;
						emEventReport['from']='app';
						console.log(JSON.stringify(emEventReport));

						api.confirm({
						    title: '提示',
						    msg: '是否审核通过此工单？',
						    buttons: ['确定', '取消']
						}, function(ret, err) {
						    var index = ret.buttonIndex;
								if(index==1){
									$client.examineSubmission(emEventReport,function(ret,err){
										var message=err.body;
										if(message.indexOf('成功')>-1){
											api.toast({
												msg : message
											});
											api.execScript({
												name : 'submission-list_win',
												frameName : 'submission-list_frm',
												script : 'refreshList();'
											});
											setTimeout(function() {
												api.closeWin();
											}, 1100);
										}else {
											api.toast({
												msg : err.body
											});
										}
									})
								}
						});

					}

					// 升级

							function submissionUpgrade(){
								var user=$api.getStorage('user');
								var opts={
									userName:user.loginname,
									from:'app',
									id:api.pageParam.id
								}
								api.confirm({
										title: '提示',
										msg: '是否升级此工单？',
										buttons: ['确定', '取消']
								}, function(ret, err) {
										var index = ret.buttonIndex;
										if(index==1){
											$client.SubmissionUpgrade(opts,function(ret,err){
												console.log(getObj(ret));
												console.log(getObj(err));
												var message=err.body;
												if(message.indexOf('成功')>-1){
													api.toast({
														msg : message
													});
													api.execScript({
														name : 'submission-list_win',
														frameName : 'submission-list_frm',
														script : 'refreshList();'
													});
													setTimeout(function() {
														api.closeWin();
													}, 1100);
												}else {
													api.toast({
														msg : err.body
													});
												}
											})
										}
								});
							}

							// 关闭

									function submissionClose(){
										var user=$api.getStorage('user');
										var opts={
											userName:user.loginname,
											from:'app',
											id:api.pageParam.id
										}
										api.confirm({
												title: '提示',
												msg: '是否关闭此工单？',
												buttons: ['确定', '取消']
										}, function(ret, err) {
												var index = ret.buttonIndex;
												if(index==1){
													$client.SubmissionClose(opts,function(ret,err){
														console.log(getObj(ret));
														console.log(getObj(err));
														var message=err.body;
														if(message.indexOf('成功')>-1){
															api.toast({
																msg : message
															});
															api.execScript({
																name : 'submission-list_win',
																frameName : 'submission-list_frm',
																script : 'refreshList();'
															});
															setTimeout(function() {
																api.closeWin();
															}, 1100);
														}else {
															api.toast({
																msg : err.body
															});
														}
													})
												}
										});
									}

					// 再次报送
					function openAgain(){
						console.log(getObj(api.pageParam));
						api.openWin({
							name : 'submission-add-again_win',
							url : 'submission-add-again_win.html',
							bounces : false,
							rect : {
								x : 0,
								y : 0,
								w : 'auto',
								h : 'auto'
							},
							reload : true,
							pageParam : api.pageParam
						});
					}

					// 退回

							function submissionRemove(){
								var opts={
										eventId:api.pageParam.id
								}
								api.confirm({
								    title: '提示',
								    msg: '是否退回此工单？',
								    buttons: ['确定', '取消']
								}, function(ret, err) {
								    var index = ret.buttonIndex;
										if(index==1){
											$client.returnSubmission(opts,function(ret,err){
												console.log(getObj(ret));
												console.log(getObj(err));
												if(err.statusCode==200){
													api.toast({
														msg : '退回成功!'
													});
													api.execScript({
														name : 'submission-list_win',
														frameName : 'submission-list_frm',
														script : 'refreshList();'
													});
													setTimeout(function() {
														api.closeWin();
													}, 1000);
												}else {
													api.toast({
														msg : '退回失败!'
													});
												}
											})
										}
								});

							}
	</script>
</html>
